<!-- File path sudo nano /home/vinay/kiosk-control/templates/index.html -->

<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pi Smart Remote</title>
<link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="container">
        <div class="top-bar">
        <div class="icon-btn" onclick="navigate('https://www.youtube.com')">YouTube</div>
        <div class="icon-btn" onclick="navigate('https://www.hotstar.com')">Hotstar</div>
        <div class="icon-btn" onclick="send('/reload')">âŸ³</div>
        <div class="icon-btn" onclick="togglePower()">â»</div>
    </div>

        <div class="url-bar">
            <input id="url" placeholder="Enter URL">
            <button onclick="openURL()">Go</button>
        </div>

        <div id="touchpad"></divfunction togglePower() {>

        <div class="controls">
            <div class="ctrl-btn" onclick="send('/left')">âŸµ</div>
            <div class="ctrl-btn" onclick="send('/right')">âŸ¶</div>
            <div class="ctrl-btn" onclick="send('/voldown')">ğŸ”‰</div>
            <div class="ctrl-btn" onclick="send('/volup')">ğŸ”Š</div>
            <div class="ctrl-btn" onclick="send('/playpause')">â¯</div>
          </div>
    
    </div>

<!-- POWER OVERLAY -->
<div id="power-overlay">
  <div class="power-box">
    <h3>Power</h3>
    <div class="power-actions">
      <button class="power-btn reboot" onclick="send('/reboot')">Reboot</button>
      <button class="power-btn shutdown" onclick="send('/shutdown')">Shutdown</button>
      <button class="power-btn cancel" onclick="togglePower()">Cancel</button>
    </div>
  </div>
</div>

<script>
/* ---------- BASIC HELPERS ---------- */
function send(route) {
    fetch(route);
}

function navigate(url) {
    if (!url) return;
    if (!url.startsWith("http")) url = "https://" + url;
    fetch(`/navigate?url=${encodeURIComponent(url)}`);
}

function openURL() {
    const input = document.getElementById("url");
    if (!input) return;
    const url = input.value.trim();
    if (url) navigate(url);
    input.value = "";
}

function togglePower() {
    const overlay = document.getElementById("power-overlay");
    overlay.style.display =
        overlay.style.display === "flex" ? "none" : "flex";
}



/* ---------- TOUCHPAD LOGIC (FIXED) ---------- */

const pad = document.getElementById("touchpad");

let sx = 0, sy = 0;
let lx = 0, ly = 0;
let startTime = 0;
let moved = false;
let fingers = 0;

const MOVE_LIMIT = 10;   // px
const CLICK_LIMIT = 200; // ms
const SPEED = 1.4;

pad.addEventListener("touchstart", e => {
    fingers = e.touches.length;
    startTime = Date.now();
    moved = false;

    if (fingers === 1) {
        sx = lx = e.touches[0].clientX;
        sy = ly = e.touches[0].clientY;
    }
});


pad.addEventListener("touchmove", e => {
    e.preventDefault();

    if (fingers === 1 && e.touches.length === 1) {
        const t = e.touches[0];
        const dx = (t.clientX - lx) * SPEED;
        const dy = (t.clientY - ly) * SPEED;

        if (Math.abs(t.clientX - sx) > MOVE_LIMIT ||
            Math.abs(t.clientY - sy) > MOVE_LIMIT) {
            moved = true;
        }

        lx = t.clientX;
        ly = t.clientY;

        fetch("/mouse_move", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({dx, dy})
        });
    }

   if (fingers === 2 && e.touches.length === 2) {
        const avgY = (e.touches[0].clientY + e.touches[1].clientY) / 2;
        const dy = avgY - ly;
        ly = avgY;
        moved = true;

        fetch("/scroll", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({dy})
        });
    }
});

pad.addEventListener("touchend", e => {
    const duration = Date.now() - startTime;

    if (fingers === 1 && !moved && duration < CLICK_LIMIT) {
        fetch("/mouse_click", {method:"POST"});
    }

    fingers = 0;
});

</script>

</body>
</html>
              
