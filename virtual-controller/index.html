<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pi Smart Remote</title>

<style>
body {
    margin: 0;
    background: #020617;
    color: #e5e7eb;
    font-family: system-ui, sans-serif;
}

.container { padding: 10px; }

.top-bar {
    display: flex;
    gap: 8px;
}

.icon-btn {
    flex: 1;
    padding: 10px;
    background: #1f2937;
    border-radius: 10px;
    text-align: center;
    cursor: pointer;
}

.url-bar {
    display: flex;
    gap: 6px;
    margin: 10px 0;
}

.url-bar input {
    flex: 1;
    padding: 8px;
    border-radius: 6px;
    border: none;
}

#touchpad {
    height: 45vh;
    background: #0f172a;
    border-radius: 14px;
    margin: 10px 0;
    touch-action: none;
}

.controls {
    display: flex;
    justify-content: space-around;
    margin-top: 10px;
}

.ctrl-btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: #1f2937;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    cursor: pointer;
}

#power {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.6);
    display: none;
    align-items: center;
    justify-content: center;
}

.power-box {
    background: #020617;
    padding: 20px;
    border-radius: 12px;
    display: flex;
    gap: 10px;
}
</style>
</head>

<body>

<div class="container">

<div class="top-bar">
    <div class="icon-btn" onclick="navigate('https://www.youtube.com')">Yo>
    <div class="icon-btn" onclick="navigate('https://www.hotstar.com')">Ho>
    <div class="icon-btn" onclick="send('/reload')">‚ü≥</div>
    <div class="icon-btn" onclick="togglePower()">‚èª</div>
</div>

<div class="url-bar">
    <input id="url" placeholder="Enter URL">
    <button onclick="openURL()">Go</button>
</div>

<div id="touchpad"></divfunction togglePower() {>

<div class="controls">
    <div class="ctrl-btn" onclick="send('/left')">‚üµ</div>
    <div class="ctrl-btn" onclick="send('/right')">‚ü∂</div>
    <div class="ctrl-btn" onclick="send('/voldown')">üîâ</div>
    <div class="ctrl-btn" onclick="send('/volup')">üîä</div>
    <div class="ctrl-btn" onclick="send('/playpause')">‚èØ</div>
</div>

</div>

<div id="power" onclick="togglePower()">
    <div class="power-box" onclick="event.stopPropagation()">
        <button onclick="send('/reboot')">Reboot</button>
        <button onclick="send('/shutdown')">Shutdown</button>
    </div>
</div>

<!-- POWER OVERLAY -->
<div id="power-overlay">
    <div class="power-box">
        <h3>Power</h3>
        <div class="power-actions">
            <button class="power-btn reboot" onclick="send('/reboot')">Reb>
            <button class="power-btn shutdown" onclick="send('/shutdown')">
            <button class="power-btn cancel" onclick="togglePower()">Cance>
        </div>
    </div>
</div>

<script>
/* ---------- BASIC HELPERS ---------- */
function send(route) {
    fetch(route);
}

function navigate(url) {
    if (!url) return;
    if (!url.startsWith("http")) url = "https://" + url;
    fetch(`/navigate?url=${encodeURIComponent(url)}`);
}

function openURL() {
    const input = document.getElementById("url");
    if (!input) return;
    const url = input.value.trim();
    if (url) navigate(url);
    input.value = "";
}

function togglePower() {
    const overlay = document.getElementById("power-overlay");
    overlay.style.display =
        overlay.style.display === "flex" ? "none" : "flex";
}



/* ---------- TOUCHPAD LOGIC (FIXED) ---------- */

const pad = document.getElementById("touchpad");

let sx = 0, sy = 0;
let lx = 0, ly = 0;
let startTime = 0;
let moved = false;
let fingers = 0;

const MOVE_LIMIT = 10;   // px
const CLICK_LIMIT = 200; // ms
const SPEED = 1.4;

pad.addEventListener("touchstart", e => {
    fingers = e.touches.length;
    startTime = Date.now();
    moved = false;

    if (fingers === 1) {
        sx = lx = e.touches[0].clientX;
        sy = ly = e.touches[0].clientY;
    }
});


pad.addEventListener("touchmove", e => {
    e.preventDefault();

    if (fingers === 1 && e.touches.length === 1) {
        const t = e.touches[0];
        const dx = (t.clientX - lx) * SPEED;
        const dy = (t.clientY - ly) * SPEED;

        if (Math.abs(t.clientX - sx) > MOVE_LIMIT ||
            Math.abs(t.clientY - sy) > MOVE_LIMIT) {
            moved = true;
        }

        lx = t.clientX;
        ly = t.clientY;

        fetch("/mouse_move", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({dx, dy})
        });
    }

   if (fingers === 2 && e.touches.length === 2) {
        const avgY = (e.touches[0].clientY + e.touches[1].clientY) / 2;
        const dy = avgY - ly;
        ly = avgY;
        moved = true;

        fetch("/scroll", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({dy})
        });
    }
});

pad.addEventListener("touchend", e => {
    const duration = Date.now() - startTime;

    if (fingers === 1 && !moved && duration < CLICK_LIMIT) {
        fetch("/mouse_click", {method:"POST"});
    }

    fingers = 0;
});

</script>

</body>
</html>
              
